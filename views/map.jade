extends layout

block content
  //- .page-header
  //-   h3 Here is the Map Dude.
  //-   p hello
  //-   p hey whats going on
  #map

  .search-bar
    form(id="searchForm", name="claim_search")
      div.input
        span.label ClientNum
        input(type="text", id="ClientNum", name="CLIENTNUM", placeholder="Client Number")
      div.input
        span.label TNRNMBRD
        input(type="text", id="TNRNMBRD", name="TNRNMBRD", placeholder="TNRNMBRD")
      //- div.input
      //-   span.label ClientNum
      //-   input(type="text", id="ClientNum", name="CLIENTNUM", placeholder="Client Number")
      //- div.input
      //-   span.label ClientNum
      //-   input(type="text", id="ClientNum", name="CLIENTNUM", placeholder="Client Number")
      div.actions
        input(type="submit", value="Search")    


  script.
    $(function() {
      $("#searchForm").on('submit',function(e){
          //- Grab ClientNum from form
        var ClientNum = $('#ClientNum').val();
        e.preventDefault();
        if (typeof featureLayer !== "undefined"){
          map.removeLayer(featureLayer);          
        };
          
        
        //- Pass in clientid: ClientNum into getJSON
        $.getJSON('/map/search', {clientid: ClientNum},function(result){
          map.featureLayer.setGeoJSON(result);
          console.log("result from server", result);
        });
      });
    });

    L.mapbox.accessToken = 'pk.eyJ1Ijoibmd1c3QiLCJhIjoiY2lraHBnaDM3MDI4aHUwbTZnenJ5dno2YyJ9.8iIZEsDPnm2nQ4jV_Yj92A';
    
    var map = L.mapbox.map('map', 'mapbox.outdoors')
            .setView([49.72902, -121.43253], 12);
            //- .featureLayer.setGeoJSON(result);
    

    //- var geojson = $.getJSON('/claims/placer',function(result){
    //-         L.mapbox.map('map', 'mapbox.outdoors')
    //-         .setView([49.72902, -121.43253], 12)
    //-         .featureLayer.setGeoJSON(result);
    //-     });