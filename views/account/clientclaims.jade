extends ../layout

block content

  h3 Client Claims

  h5#client-number #{user.CLIENTNUM}

  .client-claims-table
    //- Data table to append results to.
    table.table
      thead
        tr
          th Title Number
          th Claim Name
          th % Ownership
          th Claim Type
          th Issue Date 
          th Good Until Date
          th Area (ha)
      tbody


  script.
    $(function() {
      var clientNumber = $('#client-number').text()

      $.getJSON('/clientclaims/search', {
        clientnum: clientNumber
      },


      function(results){
        //- Put data in table
        var table = $(".client-claims-table").find('tbody');
        
        results.forEach(function(result) {
          var tr = $("<tr>").appendTo(table);

          //- Formats date to YYYYMMDD 
          var issueDate = result.properties.ISSUE_DATE.substring(0,8);
          var goodUntil = result.properties.GDTDT.substring(0,8);

          $("<td>").appendTo(tr).text(result.properties.TNRNMBRD);
          $("<td>").appendTo(tr).text(result.properties.CLAIM_NAME);
          $("<td>").appendTo(tr).text(result.properties.PRCNTOWNER); 
          $("<td>").appendTo(tr).text(result.properties.TNRTPDSCRP);
          $("<td>").appendTo(tr).text(issueDate);
          $("<td>").appendTo(tr).text(goodUntil);
          $("<td>").appendTo(tr).text(result.properties.RNHCTRS);   
        });
      });
    });